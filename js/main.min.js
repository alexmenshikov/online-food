
"use strict";const auth=()=>{const body=document.querySelector("body");const loginBtn=document.querySelector(".login");const logoutBtn=document.querySelector(".logout");const cartBtn=document.querySelector(".cart");const userName=document.querySelector(".user-name");const modalAuth=document.querySelector(".modal");const close=document.querySelector(".modal__content-close");const inputLogin=document.getElementById("login");const inputPassword=document.getElementById("password");const loginForm=document.getElementById("login-form");loginBtn.addEventListener('click',()=>{body.classList.add("block");modalAuth.style.display="flex";})
close.addEventListener('click',()=>{body.classList.remove("block");modalAuth.style.display="none";})
const validation=(user,login,password)=>{let flagLogin=false;let flagPassword=false;if(user.login){login.classList.remove("error");flagLogin=true;}else{login.classList.add("error");flagLogin=false;}
if(user.password){password.classList.remove("error");flagPassword=true;}else{password.classList.add("error");flagPassword=false;}
return(flagLogin&&flagPassword);};const login=(user)=>{loginBtn.style.display="none";logoutBtn.style.display="flex";cartBtn.style.display="flex";userName.style.display="flex";userName.textContent=user.login;modalAuth.style.display="none";body.classList.remove("block");}
const logout=()=>{loginBtn.style.display="flex";logoutBtn.style.display="none";cartBtn.style.display="none";userName.style.display="none";userName.textContent="";localStorage.removeItem("user");}
logoutBtn.addEventListener('click',()=>{logout();})
loginForm.addEventListener('submit',(event)=>{event.preventDefault();const user={login:inputLogin.value.trim(),password:inputPassword.value,};let flag=validation(user,inputLogin,inputPassword);if(flag){localStorage.setItem("user",JSON.stringify(user));login(user);}});if(localStorage.getItem("user")){login(JSON.parse(localStorage.getItem("user")));}};auth();const countingDish=()=>{const cartCount=document.querySelector(".cart__count");const cartSpan=cartCount.querySelector("span");const cart=JSON.parse(localStorage.getItem("cart"));let sumCount=0;if(cart){cart.forEach((item)=>{sumCount+=Number(item.count);});}
cartSpan.innerText=sumCount;};countingDish();const cleanCart=()=>{const body=document.querySelector("body");const modalCart=document.querySelector(".modal-cart");const delDishesBtn=document.querySelector(".modal-cart__bottom-del");if(delDishesBtn){delDishesBtn.addEventListener('click',()=>{localStorage.removeItem('cart');body.classList.remove("block");modalCart.style.display="none";removeCart();countingDish();});}};const editPositionCart=(arrayCart)=>{const cartItem=document.querySelectorAll(".modal-cart__item");cartItem.forEach((item)=>{const add=item.querySelector(".modal-cart__action-add");const remove=item.querySelector(".modal-cart__action-remove");const itemHTML=item.querySelector(".modal-cart__item-title").innerText;add.addEventListener('click',()=>{if(arrayCart.some((elem)=>elem.name===itemHTML)){arrayCart.map((elem)=>{if(elem.name===itemHTML){elem.count++;}});}
localStorage.setItem("cart",JSON.stringify(arrayCart));});remove.addEventListener('click',()=>{if(arrayCart.some((elem)=>elem.name===itemHTML)){arrayCart.map((elem)=>{if(elem.name===itemHTML){elem.count--;}});}
localStorage.setItem("cart",JSON.stringify(arrayCart));});});};const renderItemCart=(arrayItems,sum,cartItems)=>{arrayItems.forEach((item)=>{const div=document.createElement("div");div.classList.add("modal-cart__item");const{id,name,price,count}=item;div.innerHTML=`
                <div class="modal-cart__item-title">${name}</div>
                <div class="modal-cart__item-price">${price} &#8381;</div>
                <div class="modal-cart__action">
                    <div class="modal-cart__action-remove">-</div>
                    <div class="modal-cart__action-count">${count}</div>
                    <div class="modal-cart__action-add">+</div>
                </div>
            `;sum=sum+(+price*+count);cartItems.append(div);});return{cartItems,sum};}
const renderCart=()=>{const arrayItems=JSON.parse(localStorage.getItem("cart"));const cartItems=document.querySelector(".modal-cart__items");const cartContent=document.querySelector(".modal-cart__bottom");let sum=0;const item=document.createElement("div");item.classList.add("modal-cart__bottom-item");if(!arrayItems){const div=document.createElement("div");div.classList.add("modal-cart__empty");div.innerText="Ой, тут пока пусто";cartItems.append(div);}else{const returnFunc=renderItemCart(arrayItems,sum,cartItems);editPositionCart(arrayItems);item.innerHTML=`
                <div class="modal-cart__bottom-sum">Сумма <span>${returnFunc.sum} &#8381;</span></div>
                <div class="modal-cart__bottom-del">Очистить корзину</div>
        `;cartContent.append(item);}
cleanCart();};const removeCart=()=>{const cartItems=document.querySelector(".modal-cart__items");cartItems.innerHTML=``;const cartBottom=document.querySelector(".modal-cart__bottom");cartBottom.innerHTML=``;};const delDishes=()=>{const body=document.querySelector("body");const modalCart=document.querySelector(".modal-cart");localStorage.removeItem("cart");body.classList.add("block");modalCart.style.display="flex";};const openCart=()=>{const body=document.querySelector("body");const cart=document.querySelector(".cart");const modalCart=document.querySelector(".modal-cart");const close=document.querySelector(".modal-cart-close");cart.addEventListener('click',()=>{body.classList.add("block");modalCart.style.display="flex";renderCart();})
close.addEventListener('click',()=>{body.classList.remove("block");modalCart.style.display="none";removeCart();})};openCart();